<% if (message) { 
    const messageId = message.id();
    const headers = message.headers();
    const payload = message.payload();
    const traits = message.traits();
    const correlationId = message.correlationId();
    const contentType = message.contentType();
    const externalDocs = message.externalDocs();
    const showInfoList = contentType || externalDocs;

    let header = 'Message';
    const id = message.name() || messageId;
    if (message.title() || id) {
        header += ` ${(message.title() || "")}`;
        header += ` <code>${id}</code>`; %>
        <h4><%- header %></h4>
    <% } %>


      <% if(message.summary()) { %>
          <%- md.render(`*${message.summary()}*`) %>
      <% } %>

      <% if(showInfoList) { %>
        <ul>
            <% if(messageId) { %>
                <li><b>Message ID:</b> <%= messageId %></li>
            <% } %>
          <% if(contentType) { %>
            <li>
              <b>Content type:</b> <%- `<a href='https://www.iana.org/assignments/media-types/${contentType}'>${contentType}</a>` %>
            </li>
          <% } %>
          <% if(correlationId?.location()) { %>
              <li>
                <b>Correlation ID:</b> <%= correlationId?.location() %>
              </li>
              <% if(correlationId?.hasDescription()) { %>
                  <br />
                  <%- md.render(correlationId?.description()) %>
              <% } %>
          <% } %>
        </ul>
    <% } %>
    <% if(message.hasDescription()) { %>
        <%- md.render(message.description()) %>
    <% } %>
  
    <% if(externalDocs && externalDocs?.url()) { %> 
        <a href='<%= externalDocs?.url() %>'>
            <%- md.render(externalDocs?.description() || 'Find more info here.') %>
        </a>
    <% } %>
  
    <% if(headers && !headers.incorrect) { %>
        <h5>Headers</h5>
        <%- include(schemaPath,{schema:headers.schema? headers.schema : headers,schemaName:"", hideTitle:true, schemaHelper, md, path:""}) %>
        <% const ex = messageHelper.getHeadersExamples(message);
        if (ex) { %>
            <blockquote>Examples of headers</blockquote>
            <% if (ex.length !== 0) {
                    examples.map((e, idx) => { %>
                    <p><%= e.name && e.name %></p>
                    <%- e.summary && md.render(e.summary) %>
                    <code><%= JSON.stringify(e.example, null, 2) %></code>
                    <% }); %>
                <% } %>
        <% }else {
            const headers = message.headers();
            if (headers) { %>
                <blockquote>Examples of headers _generated_</blockquote>
                <code><%- md.render(messageHelper.generateExample(headers.json())) %></code>
            <% } %>
        <% } %> 

    <% }else if(headers?.incorrect && Object.values(headers || []).length > 1) { %>
            <div>
                <h5>Headers</h5>
                <ul><%= renderObject(headers, 0) %></ul>
            </div>
    <% } %>    
  
        <% if(payload && !payload.incorrect) { %>
            <h5>Payload</h5>
            <%- include(schemaPath,{schema:payload.schema? payload.schema : payload, schemaName:"", hideTitle:true, schemaHelper, md, path:""}) %>
            <% const examples = messageHelper.getPayloadExamples(message);
            if (examples) { %>
                    <blockquote>Examples of payload</blockquote>
                    <% if (examples.length !== 0) {
                        examples.map((ex, idx) => { %>
                        <p><%= ex.name && ex.name %></p>
                        <%- ex.summary && md.render(ex.summary) %>
                        <code><%- md.render(JSON.stringify(ex.example, null, 2)) %></code>
                        <% }); %>
                   <% } %>
            <% }else { 
                const payload = message?.payload();
                if (payload) { %>
                    <blockquote>Examples of payload _generated_</blockquote>
                    <code><%- md.render(messageHelper.generateExample(payload.json())) %></code>
                <% } %>
    
            <% } %>

            <% }else if(payload?.incorrect && Object.values(payload || []).length > 1) { %>
                        <div>
                            <h5>Payload</h5>
                            <ul><%= renderObject(payload, 0) %></ul>
                        </div>
            <% } %> 
            
            <% if(traits?.incorrect && Object.values(traits || []).length > 1) { %>
                <div>
                    <h5>Message Traits</h5>
                    <ul><%= renderObject(traits, 0) %></ul>
                </div>
            <% } %>
  
        <%- include(bindingsPath,{name:"Message specific information", bindings:message.bindings(), schemaHelper, schemaPath}) %>
        <%- include(extensionsPath,{name:"Message extensions", extensions:message.extensions(), schemaHelper, schemaPath}) %>
        <%- include(tagsPath,{name:"Message tags", tags:message.tags()}) %>
<% } %>

<% function renderObject(obj, indent) { %>
    <% for (let key in obj) { %>
        <% if (key != 'incorrect') { %>
        <% if (typeof obj[key] === 'object' && obj[key] !== null) { %>
            <li class="nested-object">
                <span class="key"><%= key %>:</span>
                <ul>
                    <%= renderObject(obj[key], indent + 20) %>
                </ul>
            </li>
        <% } else { %>
            <li class="nested-object">
                <span class="key"><%= key %>:</span>
                <span class="value"><%= obj[key] %></span>
            </li>
        <% } %>
        <% } %>
    <% } %>
<% } %>

